<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>طقسنا - الإحصائيات</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-dark: #0a0e17;
      --secondary-dark: #131a2a;
      --accent-blue: #4361ee;
      --accent-purple: #7209b7;
      --accent-pink: #f72585;
      --accent-cyan: #4cc9f0;
      --accent-green: #2ec4b6;
      --text-color: #f8fafc;
      --card-bg: rgba(30, 41, 59, 0.8);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      --gradient: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
    }

    .light-mode {
      --primary-dark: #c5d3e6;
      --secondary-dark: #d6e2f3;
      --text-color: #1e293b;
      --card-bg: rgba(255, 255, 255, 0.9);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s, color 0.3s;
    }

    body {
      font-family: 'Tajawal', 'Tahoma', sans-serif;
      background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
      color: var(--text-color);
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 30px;
      padding: 0 15px;
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5rem;
    }

    .app-title i {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 1.8rem;
    }

    .controls {
      display: flex;
      gap: 15px;
    }

    .theme-switch, .telegram-btn, .nav-btn {
      background: var(--card-bg);
      border: none;
      border-radius: 50px;
      padding: 10px 15px;
      color: var(--text-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
      transition: transform 0.2s;
    }

    .theme-switch:hover, .telegram-btn:hover, .nav-btn:hover {
      transform: translateY(-2px);
    }

    .telegram-btn {
      background: #0088cc;
    }

    .telegram-btn i {
      color: white;
    }

    .nav-btn.active {
      background: var(--gradient);
    }

    .nav-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .content-section {
      width: 100%;
      display: none;
    }

    .content-section.active {
      display: block;
    }

    .weather-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .current-weather {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .temperature-circle {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .temperature-circle::after {
      content: '';
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.2);
    }

    .temp-value {
      font-size: 3.5rem;
      font-weight: bold;
      line-height: 1;
    }

    .temp-unit {
      font-size: 1.5rem;
      margin-top: 5px;
    }

    .weather-desc {
      font-size: 1.2rem;
      margin-top: 10px;
    }

    .weather-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      width: 100%;
      max-width: 500px;
      margin-top: 20px;
    }

    .detail-card {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .detail-card i {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--accent-cyan);
    }

    .forecast-container {
      width: 100%;
      overflow-x: auto;
      padding: 15px 0;
      margin-bottom: 20px;
    }

    .forecast {
      display: flex;
      gap: 20px;
      padding: 10px 5px;
    }

    .day {
      background: var(--card-bg);
      padding: 20px 15px;
      border-radius: 20px;
      min-width: 150px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .day h3 {
      margin-bottom: 15px;
      font-size: 1.1rem;
      color: var(--accent-pink);
    }

    .day-icon {
      font-size: 2rem;
      margin: 10px 0;
      color: var(--accent-green);
    }

    .day-temp {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 5px 0;
    }

    .day-details {
      margin-top: 10px;
      width: 100%;
    }

    .day-details p {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 0.9rem;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 100%;
      margin-top: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 20px;
      box-shadow: var(--shadow);
    }

    .stat-card h3 {
      margin-bottom: 15px;
      color: var(--accent-cyan);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50vh;
      flex-direction: column;
      gap: 20px;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent-pink);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: #e74c3c;
      color: white;
      padding: 20px;
      border-radius: 15px;
      margin: 30px 0;
      width: 100%;
      max-width: 500px;
    }

    .location-info {
      margin-bottom: 20px;
      font-size: 1.2rem;
    }

    .location-info i {
      color: var(--accent-pink);
      margin-left: 8px;
    }

    .hourly-forecast {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding: 15px 0;
      margin-top: 20px;
    }

    .hour-item {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 15px;
      min-width: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--shadow);
    }

    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 15px;
      }
      
      .weather-details {
        grid-template-columns: 1fr;
      }
      
      .temperature-circle {
        width: 180px;
        height: 180px;
      }
      
      .temp-value {
        font-size: 2.8rem;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="app-title">
        <i class="fas fa-cloud-sun"></i>
        <h1>طقسنا</h1>
      </div>
      <div class="controls">
        <a href="https://t.me/A_zon1" target="_blank" class="telegram-btn">
          <i class="fab fa-telegram"></i>
          <span>قناة التحديثات</span>
        </a>
        <button class="theme-switch" id="themeSwitch">
          <i class="fas fa-moon"></i>
          <span>تبديل المظهر</span>
        </button>
      </div>
    </header>

    <div class="nav-container">
      <button class="nav-btn active" data-target="weather">
        <i class="fas fa-cloud-sun"></i>
        <span>الطقس</span>
      </button>
      <button class="nav-btn" data-target="stats">
        <i class="fas fa-chart-line"></i>
        <span>الإحصائيات</span>
      </button>
      <button class="nav-btn" data-target="details">
        <i class="fas fa-info-circle"></i>
        <span>التفاصيل</span>
      </button>
    </div>

    <div class="content-section active" id="weather-content">
      <div class="weather-container">
        <div id="location" class="location-info">
          <div class="loading">
            <div class="spinner"></div>
            <p>جارٍ تحديد الموقع...</p>
          </div>
        </div>
        
        <div class="current-weather">
          <div id="current">
            <!-- سيتم ملؤها بواسطة JavaScript -->
          </div>
        </div>
        
        <div class="forecast-container">
          <div id="forecast" class="forecast">
            <!-- سيتم ملؤها بواسطة JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <div class="content-section" id="stats-content">
      <div class="stats-container">
        <div class="stat-card">
          <h3><i class="fas fa-temperature-high"></i> درجات الحرارة</h3>
          <div class="chart-container">
            <canvas id="tempChart"></canvas>
          </div>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-tint"></i> هطول الأمطار</h3>
          <div class="chart-container">
            <canvas id="rainChart"></canvas>
          </div>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-wind"></i> سرعة الرياح</h3>
          <div class="chart-container">
            <canvas id="windChart"></canvas>
          </div>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-sun"></i> حالة الطقس</h3>
          <div class="chart-container">
            <canvas id="weatherChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="content-section" id="details-content">
      <div class="stats-container">
        <div class="stat-card">
          <h3><i class="fas fa-clock"></i> الطقس كل ساعة</h3>
          <div class="hourly-forecast" id="hourly-forecast">
            <!-- سيتم ملؤها بواسطة JavaScript -->
          </div>
        </div>
        
        <div class="stat-card">
          <h3><i class="fas fa-info-circle"></i> معلومات إضافية</h3>
          <div class="weather-details">
            <div class="detail-card">
              <i class="fas fa-temperature-low"></i>
              <span>الإشعاع الشمسي</span>
              <b id="uv-index">--</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-eye"></i>
              <span>الرؤية</span>
              <b id="visibility">-- km</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-tachometer-alt"></i>
              <span>الضغط</span>
              <b id="pressure">-- hPa</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-percentage"></i>
              <span>الرطوبة</span>
              <b id="humidity">--%</b>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // عناصر DOM
    const themeSwitch = document.getElementById('themeSwitch');
    const body = document.body;
    const navButtons = document.querySelectorAll('.nav-btn');
    const contentSections = document.querySelectorAll('.content-section');

    // تحميل تفضيلات المستخدم من localStorage
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light-mode') {
        body.classList.add('light-mode');
        themeSwitch.innerHTML = '<i class="fas fa-sun"></i><span>الوضع النهاري</span>';
      } else {
        themeSwitch.innerHTML = '<i class="fas fa-moon"></i><span>الوضع الليلي</span>';
      }
      
      // إضافة فعالية أزرار التنقل
      navButtons.forEach(button => {
        button.addEventListener('click', () => {
          const target = button.getAttribute('data-target');
          
          // إزالة النشاط من جميع الأزرار والأقسام
          navButtons.forEach(btn => btn.classList.remove('active'));
          contentSections.forEach(section => section.classList.remove('active'));
          
          // إضافة النشاط للزر والقسم المحدد
          button.classList.add('active');
          document.getElementById(`${target}-content`).classList.add('active');
        });
      });
    });

    // تبديل الوضع الليلي/النهاري
    themeSwitch.addEventListener('click', () => {
      body.classList.toggle('light-mode');
      if (body.classList.contains('light-mode')) {
        themeSwitch.innerHTML = '<i class="fas fa-sun"></i><span>الوضع النهاري</span>';
        localStorage.setItem('theme', 'light-mode');
      } else {
        themeSwitch.innerHTML = '<i class="fas fa-moon"></i><span>الوضع الليلي</span>';
        localStorage.setItem('theme', 'dark-mode');
      }
      
      // إعادة رسم الرسوم البيانية عند تغيير المظهر
      if (window.tempChart) {
        createCharts(weatherData);
      }
    });

    // دالة للحصول على أيقونة الطقس بناءً على رمز الطقس
    function getWeatherIcon(weatherCode, isDay = true) {
      if (weatherCode === 0) return isDay ? 'fa-sun' : 'fa-moon';
      if (weatherCode <= 3) return 'fa-cloud-sun';
      if (weatherCode <= 48) return 'fa-smog';
      if (weatherCode <= 67 || weatherCode <= 77) return 'fa-cloud-rain';
      if (weatherCode <= 99) return 'fa-cloud-showers-heavy';
      return 'fa-cloud';
    }

    // دالة لتحديد وصف الطقس بالعربية
    function getWeatherDescription(weatherCode) {
      if (weatherCode === 0) return "صافي";
      if (weatherCode <= 3) return "غائم جزئياً";
      if (weatherCode <= 48) return "ضباب";
      if (weatherCode <= 67) return "ممطر";
      if (weatherCode <= 77) return "ثلج";
      if (weatherCode <= 99) return "عاصف ممطر";
      return "غائم";
    }

    // دالة لإنشاء الرسوم البيانية
    function createCharts(data) {
      const isDarkMode = !body.classList.contains('light-mode');
      const textColor = isDarkMode ? '#f8fafc' : '#1e293b';
      const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      
      // رسم بياني لدرجات الحرارة
      if (window.tempChart) {
        window.tempChart.destroy();
      }
      const tempCtx = document.getElementById('tempChart').getContext('2d');
      window.tempChart = new Chart(tempCtx, {
        type: 'line',
        data: {
          labels: data.daily.time.map(date => new Date(date).toLocaleDateString('ar-EG', { weekday: 'short' })),
          datasets: [{
            label: 'الحد الأقصى',
            data: data.daily.temperature_2m_max,
            borderColor: '#f72585',
            backgroundColor: 'rgba(247, 37, 133, 0.1)',
            tension: 0.3,
            fill: true
          }, {
            label: 'الحد الأدنى',
            data: data.daily.temperature_2m_min,
            borderColor: '#4361ee',
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: textColor }
            }
          },
          scales: {
            y: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            },
            x: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            }
          }
        }
      });
      
      // رسم بياني لهطول الأمطار
      if (window.rainChart) {
        window.rainChart.destroy();
      }
      const rainCtx = document.getElementById('rainChart').getContext('2d');
      window.rainChart = new Chart(rainCtx, {
        type: 'bar',
        data: {
          labels: data.daily.time.map(date => new Date(date).toLocaleDateString('ar-EG', { weekday: 'short' })),
          datasets: [{
            label: 'هطول الأمطار (ملم)',
            data: data.daily.precipitation_sum,
            backgroundColor: 'rgba(76, 201, 240, 0.7)',
            borderColor: '#4cc9f0',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: textColor }
            }
          },
          scales: {
            y: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            },
            x: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            }
          }
        }
      });
      
      // رسم بياني لسرعة الرياح (بيانات وهمية للتوضيح)
      if (window.windChart) {
        window.windChart.destroy();
      }
      const windCtx = document.getElementById('windChart').getContext('2d');
      const windData = data.daily.time.map(() => Math.random() * 20 + 5);
      window.windChart = new Chart(windCtx, {
        type: 'line',
        data: {
          labels: data.daily.time.map(date => new Date(date).toLocaleDateString('ar-EG', { weekday: 'short' })),
          datasets: [{
            label: 'سرعة الرياح (كم/ساعة)',
            data: windData,
            borderColor: '#7209b7',
            backgroundColor: 'rgba(114, 9, 183, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: textColor }
            }
          },
          scales: {
            y: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            },
            x: {
              grid: { color: gridColor },
              ticks: { color: textColor }
            }
          }
        }
      });
      
      // رسم بياني دائري لحالة الطقس (بيانات وهمية للتوضيح)
      if (window.weatherChart) {
        window.weatherChart.destroy();
      }
      const weatherCtx = document.getElementById('weatherChart').getContext('2d');
      window.weatherChart = new Chart(weatherCtx, {
        type: 'doughnut',
        data: {
          labels: ['صافي', 'غائم', 'ممطر', 'ضباب'],
          datasets: [{
            data: [40, 25, 20, 15],
            backgroundColor: ['#4cc9f0', '#4361ee', '#7209b7', '#f72585']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: textColor }
            }
          }
        }
      });
    }

    // دالة لإنشاء توقعات كل ساعة (بيانات وهمية للتوضيح)
    function createHourlyForecast() {
      const hourlyContainer = document.getElementById('hourly-forecast');
      hourlyContainer.innerHTML = '';
      
      const now = new Date();
      for (let i = 0; i < 12; i++) {
        const hour = new Date(now.getTime() + i * 60 * 60 * 1000);
        const temp = Math.round(Math.random() * 10 + 15);
        
        hourlyContainer.innerHTML += `
          <div class="hour-item">
            <div>${hour.toLocaleTimeString('ar-EG', { hour: '2-digit' })}</div>
            <i class="fas ${getWeatherIcon(Math.floor(Math.random() * 10))}"></i>
            <div>${temp}°</div>
          </div>
        `;
      }
    }

    // دالة لملء المعلومات الإضافية (بيانات وهمية للتوضيح)
    function fillAdditionalInfo() {
      document.getElementById('uv-index').textContent = Math.floor(Math.random() * 5 + 3);
      document.getElementById('visibility').textContent = (Math.random() * 5 + 5).toFixed(1) + ' km';
      document.getElementById('pressure').textContent = Math.floor(Math.random() * 20 + 1000) + ' hPa';
      document.getElementById('humidity').textContent = Math.floor(Math.random() * 40 + 40) + '%';
    }

    let weatherData; // لتخزين بيانات الطقس للاستخدام في الرسوم البيانية

    async function getWeather() {
      try {
        // 1. جلب الموقع باستخدام IP
        let locRes = await fetch("https://ipapi.co/json/");
        let locData = await locRes.json();

        let city = locData.city;
        let country = locData.country_name;
        let lat = locData.latitude;
        let lon = locData.longitude;

        document.getElementById("location").innerHTML = `
          <h2><i class="fas fa-location-dot"></i> ${city}, ${country}</h2>
        `;

        // 2. جلب بيانات الطقس من Open-Meteo
        let weatherRes = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto`
        );
        weatherData = await weatherRes.json();

        // الطقس الحالي
        let current = weatherData.current_weather;
        document.getElementById("current").innerHTML = `
          <div class="temperature-circle">
            <div class="temp-value">${current.temperature}</div>
            <div class="temp-unit">°C</div>
            <div class="weather-desc">${getWeatherDescription(current.weathercode)}</div>
          </div>
          <div class="weather-details">
            <div class="detail-card">
              <i class="fas fa-wind"></i>
              <span>الرياح</span>
              <b>${current.windspeed} km/h</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-compass"></i>
              <span>اتجاه الرياح</span>
              <b>${current.winddirection}°</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-temperature-high"></i>
              <span>العظمى</span>
              <b>${weatherData.daily.temperature_2m_max[0]}°C</b>
            </div>
            <div class="detail-card">
              <i class="fas fa-temperature-low"></i>
              <span>الصغرى</span>
              <b>${weatherData.daily.temperature_2m_min[0]}°C</b>
            </div>
          </div>
        `;

        // توقعات الأسبوع
        let forecast = document.getElementById("forecast");
        forecast.innerHTML = "";
        let days = weatherData.daily.time;
        
        for (let i = 0; i < days.length; i++) {
          let date = new Date(days[i]);
          let dayName = date.toLocaleDateString("ar-EG", { weekday: "long" });
          let dayNum = date.getDate();
          let month = date.toLocaleDateString("ar-EG", { month: "short" });
          
          forecast.innerHTML += `
            <div class="day">
              <h3>${dayName}</h3>
              <p>${dayNum} ${month}</p>
              <i class="fas ${getWeatherIcon(weatherData.daily.weathercode[i])} day-icon"></i>
              <div class="day-temp">${weatherData.daily.temperature_2m_max[i]}°</div>
              <div class="day-details">
                <p>
                  <span>الصغرى:</span>
                  <span>${weatherData.daily.temperature_2m_min[i]}°C</span>
                </p>
                <p>
                  <span>الأمطار:</span>
                  <span>${weatherData.daily.precipitation_sum[i]} ملم</span>
                </p>
              </div>
            </div>
          `;
        }
        
        // إنشاء الرسوم البيانية والمعلومات الإضافية
        createCharts(weatherData);
        createHourlyForecast();
        fillAdditionalInfo();
        
      } catch (err) {
        document.getElementById("location").innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>تعذر تحديد الموقع أو جلب البيانات</h3>
            <p>يرجى التحقق من اتصال الإنترنت والمحاولة مرة أخرى</p>
          </div>
        `;
        console.error(err);
      }
    }

    getWeather();
  </script>
</body>
</html>
